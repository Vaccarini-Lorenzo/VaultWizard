"use strict";var b=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var T=Object.prototype.hasOwnProperty;var H=(i,e)=>{for(var t in e)b(i,t,{get:e[t],enumerable:!0})},N=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of I(e))!T.call(i,s)&&s!==t&&b(i,s,{get:()=>e[s],enumerable:!(r=S(e,s))||r.enumerable});return i};var B=i=>N(b({},"__esModule",{value:!0}),i);var W={};H(W,{default:()=>u});module.exports=B(W);var f=require("obsidian");var p="obsidian-vault-wizard-chat-view";var k=require("obsidian");var C=require("obsidian");function y(i,e,t){let r=i.createDiv({cls:"vault-wizard-header"});r.createEl("h3",{text:"AI Helper",cls:"vault-wizard-title"});let s=r.createDiv({cls:"vault-wizard-header-actions"}),o=s.createEl("button",{cls:"vault-wizard-icon-btn"});o.setAttribute("aria-label","Open debug panel"),(0,C.setIcon)(o,"bug"),o.addEventListener("click",e);let a=s.createEl("button",{cls:"vault-wizard-icon-btn"});a.setAttribute("aria-label","Open settings panel"),(0,C.setIcon)(a,"settings"),a.addEventListener("click",t)}function A(i,e){let t=i.createDiv({cls:"vault-wizard-message-list"});for(let r of e)t.createDiv({cls:`vault-wizard-message vault-wizard-${r.role}`}).createDiv({cls:"vault-wizard-message-content",text:r.content});t.scrollTop=t.scrollHeight}function x(i,e,t){let r=i.createDiv({cls:"vault-wizard-composer"}),s=r.createEl("textarea",{cls:"vault-wizard-input",attr:{placeholder:"Type message (/c for current note content)..."}}),o=r.createEl("button",{cls:"vault-wizard-send-btn",text:t?"...":"Send"});o.disabled=t;let a=async()=>{let n=s.value;s.value="",await e(n)};o.addEventListener("click",a),s.addEventListener("keydown",async n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),await a())})}function M(i,e){let t=i.createDiv({cls:"vault-wizard-debug-wrap"}),r=t.createDiv({cls:"vault-wizard-header"});r.createEl("h3",{text:"Debug",cls:"vault-wizard-title"}),r.createEl("button",{cls:"vault-wizard-icon-btn",text:"Back"}).addEventListener("click",()=>e.openChatPanel());let o=t.createEl("pre",{cls:"vault-wizard-debug-pre"}),a={messageCount:e.getMessages().length,streaming:e.isStreaming(),activeNotePath:e.getActiveNotePath(),configuredModels:e.getConfiguredModels().length};o.textContent=JSON.stringify(a,null,2)}function w(i,e){let t=i.createDiv({cls:"vault-wizard-settings-wrap"}),r=t.createDiv({cls:"vault-wizard-header"});r.createEl("h3",{text:"Settings",cls:"vault-wizard-title"}),r.createEl("button",{cls:"vault-wizard-icon-btn vault-wizard-ghost-btn",text:"Back"}).addEventListener("click",()=>e.openChatPanel()),t.createEl("p",{cls:"vault-wizard-settings-description",text:"Manage model connections used by the assistant."});let o=t.createDiv({cls:"vault-wizard-settings-card vault-wizard-form-card"});o.createEl("h4",{cls:"vault-wizard-settings-subtitle",text:"Available models"});let a=o.createDiv({cls:"vault-wizard-settings-list"}),n=e.getConfiguredModels();if(n.length===0)a.createDiv({cls:"vault-wizard-settings-empty",text:"No models configured yet."});else for(let d of n){let E=a.createDiv({cls:"vault-wizard-settings-row"});E.createSpan({cls:"vault-wizard-settings-provider-badge",text:d.provider}),E.createSpan({cls:"vault-wizard-settings-model-name",text:d.modelName})}t.createDiv({cls:"vault-wizard-settings-actions"}).createEl("button",{cls:"vault-wizard-send-btn vault-wizard-settings-primary-action",text:"Add a model"}).addEventListener("click",()=>e.openAddModelPanel())}function l(i,e,t){let r=i.createDiv({cls:"vault-wizard-form-field"});r.createEl("label",{cls:"vault-wizard-form-label",text:e}),r.createEl("input",{cls:"vault-wizard-form-input",attr:{type:"text",placeholder:t}})}function L(i,e){if(i.empty(),e==="azure"){l(i,"Endpoint","https://your-resource.openai.azure.com"),l(i,"API Key","Azure API key"),l(i,"Deployment Name","e.g. gpt-4o-mini"),l(i,"API Version","e.g. 2024-10-21");return}if(e==="openai"){l(i,"API Key","OpenAI API key"),l(i,"Model","e.g. gpt-4.1-mini"),l(i,"Base URL (optional)","https://api.openai.com/v1");return}l(i,"API Key","Anthropic API key"),l(i,"Model","e.g. claude-3-5-sonnet-latest")}function D(i,e){let t=i.createDiv({cls:"vault-wizard-settings-wrap"}),r=t.createDiv({cls:"vault-wizard-header"});r.createEl("h3",{text:"Add a model",cls:"vault-wizard-title"}),r.createEl("button",{cls:"vault-wizard-icon-btn vault-wizard-ghost-btn",text:"Back"}).addEventListener("click",()=>e.returnToSettingsPanel());let o=t.createEl("p",{cls:"vault-wizard-add-model-description",text:"Choose your AI provider to reveal the required connection fields."}),a=t.createDiv({cls:"vault-wizard-form vault-wizard-form-card"}),n=a.createDiv({cls:"vault-wizard-form-field"});n.createEl("label",{cls:"vault-wizard-form-label",text:"AI Provider"});let c=n.createEl("select",{cls:"vault-wizard-form-select vault-wizard-provider-select"});c.createEl("option",{value:"",text:"Select provider..."}),c.createEl("option",{value:"azure",text:"Azure"}),c.createEl("option",{value:"openai",text:"OpenAI"}),c.createEl("option",{value:"anthropic",text:"Anthropic"});let P=a.createDiv({cls:"vault-wizard-form-provider-fields vault-wizard-provider-fields-card"});c.addEventListener("change",()=>{let d=c.value;if(!d){P.empty();return}L(P,d)}),o.textContent||(o.textContent="")}var h=class extends k.ItemView{constructor(t,r){super(t);this.controller=r}getViewType(){return p}getDisplayText(){return"AI Helper Chat"}getIcon(){return"bot"}async onOpen(){this.unsubscribe=this.controller.subscribe(()=>this.render()),this.render()}async onClose(){this.unsubscribe?.()}render(){let{contentEl:t}=this;t.empty(),t.addClass("vault-wizard-root");let r=this.controller.getActivePanel();if(r==="debug"){M(t,this.controller);return}if(r==="settings"){w(t,this.controller);return}if(r==="add-model"){D(t,this.controller);return}y(t,()=>this.controller.openDebugPanel(),()=>this.controller.openSettingsPanel()),A(t,this.controller.getMessages()),x(t,async s=>this.controller.onUserMessage(s),this.controller.isStreaming())}};var g=class{constructor(e){this.app=e}async getActiveNoteContent(){let e=this.app.workspace.getActiveFile();return e?this.app.vault.cachedRead(e):"No active note is open."}getActiveNotePath(){return this.app.workspace.getActiveFile()?.path??"(none)"}};var m=class{async streamEcho(e,t){let r=`echo: ${e}`;for(let s=0;s<r.length;s+=3)t(r.slice(s,s+3)),await this.sleep(35)}sleep(e){return new Promise(t=>window.setTimeout(t,e))}};var v=class{constructor(e,t){this.noteService=e;this.chatService=t;this.listeners=new Set;this.messages=[];this.configuredModels=[];this.activePanel="chat";this.streaming=!1}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}getMessages(){return this.messages}getConfiguredModels(){return this.configuredModels}getActivePanel(){return this.activePanel}isStreaming(){return this.streaming}getActiveNotePath(){return this.noteService.getActiveNotePath()}openChatPanel(){this.setActivePanel("chat")}openDebugPanel(){this.setActivePanel("debug")}openSettingsPanel(){this.setActivePanel("settings")}openAddModelPanel(){this.setActivePanel("add-model")}returnToSettingsPanel(){this.setActivePanel("settings")}async onUserMessage(e){let t=e.trim();if(!t||this.streaming)return;if(t==="/c"){let s=await this.noteService.getActiveNoteContent();this.messages.push({role:"assistant",content:s,timestamp:Date.now()}),this.notify();return}this.messages.push({role:"user",content:t,timestamp:Date.now()});let r={role:"assistant",content:"",timestamp:Date.now()};this.messages.push(r),this.streaming=!0,this.notify(),await this.chatService.streamEcho(t,s=>{r.content+=s,this.notify()}),this.streaming=!1,this.notify()}setActivePanel(e){this.activePanel!==e&&(this.activePanel=e,this.notify())}notify(){for(let e of this.listeners)e()}};var u=class extends f.Plugin{async onload(){let e=new g(this.app),t=new m;this.controller=new v(e,t),this.registerView(p,r=>new h(r,this.controller)),this.addRibbonIcon("message-square","Toggle AI Helper Chat",async()=>{await this.toggleChat()}),this.addCommand({id:"toggle-vault-wizard-chat",name:"Toggle AI Helper Chat",callback:async()=>{await this.toggleChat()}})}onunload(){this.app.workspace.detachLeavesOfType(p)}async toggleChat(){let e=this.app.workspace.getLeavesOfType(p);if(e.length>0){e.forEach(r=>r.detach());return}let t=this.app.workspace.getRightLeaf(!1);if(!t){new f.Notice("Could not open AI Helper panel.");return}await t.setViewState({type:p,active:!0}),this.app.workspace.revealLeaf(t)}};
